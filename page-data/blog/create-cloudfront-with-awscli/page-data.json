{"componentChunkName":"component---src-templates-blog-jsx","path":"/blog/create-cloudfront-with-awscli/","result":{"data":{"markdownRemark":{"fields":{"urlPath":"/blog/create-cloudfront-with-awscli/","jstDate":"2016-11-03"},"html":"<blockquote>\n<p><a href=\"/blog/update-cloudfront-with-awscli\">CloudFrontの設定をコマンドラインから更新する</a></p>\n</blockquote>\n<p>の続き。前回は更新で今回は作成です。</p>\n<!--more-->\n<h2>準備</h2>\n<p>ツールの設定周りは</p>\n<blockquote>\n<p><a href=\"/blog/update-cloudfront-with-awscli\">CloudFrontの設定をコマンドラインから更新する</a></p>\n</blockquote>\n<p>と同じなので参照してください。</p>\n<h2>Distribution設定ファイルを新規作成する</h2>\n<p>新規作成するか、既存からコピーするかの2択になるかと思います。</p>\n<h3>新規作成</h3>\n<p>AWS CLIにskeleton（雛形）作成オプションがあるので叩きます。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">aws cloudfront create-distribution --generate-cli-skeleton <span class=\"token operator\">></span> <span class=\"token variable\">$jsonPath</span></code></pre></div>\n<h3>既存からコピー</h3>\n<blockquote>\n<p><a href=\"/blog/update-cloudfront-with-awscli\">CloudFrontの設定をコマンドラインから更新する</a></p>\n</blockquote>\n<p>の “Distribution設定ファイルを取得する” で取得したものから作成します。</p>\n<p>取得用jsonと作成用jsonはフォーマットが違うので編集します。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">aws cloudfront get-distribution --id <span class=\"token variable\">${SRC_DISTRIBUTION_ID}</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\n    jq -r <span class=\"token string\">\".Distribution\n            | { DistributionConfig: .DistributionConfig }\n            | .DistributionConfig.CallerReference = <span class=\"token entity\" title=\"\\&quot;\">\\\"</span><span class=\"token variable\">${callerReference}</span><span class=\"token entity\" title=\"\\&quot;\">\\\"</span>\"</span> <span class=\"token operator\">></span> <span class=\"token variable\">$jsonPath</span></code></pre></div>\n<p><code class=\"language-text\">$callerReference</code> の値ですが、distribution間で一意にする必要があります。ミリ秒のタイムスタンプを入れつつ、被る場合は調整するのがオススメ。</p>\n<h2>CloudFrontに設定ファイルを反映する</h2>\n<p>コマンド一発です。ミスってもエラーが出るだけなので怖くない。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">aws cloudfront create-distribution --cli-input-json file://<span class=\"token variable\">$jsonPath</span></code></pre></div>\n<h2>以上</h2>\n<p>新環境作成時に使いまわせるので非常に便利。</p>\n<blockquote>\n<p>追記：</p>\n<p>一連のコマンドをスクリプト化して管理ツールっぽくしました</p>\n<blockquote>\n<p><a href=\"/blog/create-cloudfront-manager\">CloudFrontのawscliでjson管理できる環境を整備した</a></p>\n</blockquote>\n</blockquote>","excerpt":"CloudFrontの設定をコマンドラインから更新する の続き。前回は更新で今回は作成です。","frontmatter":{"date":"2016-11-03T18:00:00+09:00","title":"CloudFrontの設定をコマンドラインから作成する","tags":["Development","Shell","AWS","CloudFront"],"eyecatch":null}}},"pageContext":{"urlPath":"/blog/create-cloudfront-with-awscli/","previous":{"fields":{"urlPath":"/blog/log4j-default-value/","jstDate":"2016-07-10"},"frontmatter":{"title":"log4j.xmlでデフォルト値を設定する方法","date":"2016-07-09"}},"next":{"fields":{"urlPath":"/blog/create-cloudfront-manager/","jstDate":"2016-11-04"},"frontmatter":{"title":"CloudFrontのawscliでjson管理できる環境を整備した","date":"2016-11-03"}}}},"staticQueryHashes":["1862978031","277821901","4270455655"]}