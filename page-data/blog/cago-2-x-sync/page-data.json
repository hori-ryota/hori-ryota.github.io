{"componentChunkName":"component---src-templates-blog-jsx","path":"/blog/cago-2-x-sync/","result":{"data":{"markdownRemark":{"fields":{"urlPath":"/blog/cago-2-x-sync/","jstDate":"2017-09-06"},"html":"<p><a href=\"https://cyberagent.connpass.com/event/64974/\">CA.go #2 - connpass</a> にて golang.org/x/sync 以下にある4つのパッケージを用いて効率的に非同期処理をする技術についてお話しました。</p>\n<!--more-->\n<h2>登壇内容</h2>\n<p><a href=\"https://speakerdeck.com/horiryota/syncniyoruxiao-lu-de-nafei-tong-qi-chu-li\">golang.org/x/sync による効率的な非同期処理</a> と題し、 <a href=\"https://godoc.org/golang.org/x/sync\">golang.org/x/sync</a> の使い所と雑感、注意点について紹介しました。</p>\n<blockquote>\n<p><a href=\"https://godoc.org/golang.org/x/sync\">sync - GoDoc</a></p>\n</blockquote>\n<div\n          style=\"position: relative; width:100%; height:0; padding-top:74.92957746478874%;\"\n          >\n          <iframe id=\"talk_frame_405683\" src=\"//speakerdeck.com/player/45885cc31e40446a932ac73b560eca86\" width=100% height=\"100%\" style=\"position:absolute;top:0;left:0;border:0; padding:0; margin:0; background:transparent;\" frameborder=\"0\" allowtransparency=\"true\" allowfullscreen=\"allowfullscreen\" mozallowfullscreen=\"true\" webkitallowfullscreen=\"true\"></iframe>\n\n          </div>\n<p><a href=\"/blog/cago-1-sync-pool\">第一回</a>で紹介した sync.Pool と同じく “明日から使える” 系です。</p>\n<p>内容はスライドを参照いただければ問題ないかと思いますが、概要としては以下です。</p>\n<ul>\n<li><code class=\"language-text\">golang.org/x</code> は Go のプロジェクトではあるが標準パッケージとは別で管理されているライブラリ群</li>\n<li><code class=\"language-text\">golang.org/x/sync</code> は標準パッケージの <code class=\"language-text\">sync</code> や <code class=\"language-text\">sync/atomic</code> に入れる前のおためし版的な扱いっぽい</li>\n<li><code class=\"language-text\">syncmap</code> は排他制御付きの <code class=\"language-text\">map</code> 。 Go 1.9 から標準パッケージの仲間入り</li>\n<li><code class=\"language-text\">errgroup</code> は <code class=\"language-text\">sync.WaitGroup</code> みたいに全非同期処理が終わるまで wait するやつ。エラーが起きた場合、 <code class=\"language-text\">context</code>で cancel させて始めのエラーを返す</li>\n<li><code class=\"language-text\">semaphore</code> は重み付きの並列数管理。 <code class=\"language-text\">context</code> に対応しているので待ち時間のタイムアウトもできる</li>\n<li><code class=\"language-text\">singleflight</code> は並列に叩かれる処理で使うもので、1つ目以外の処理リクエストは待たせておいて、1つ目の処理が終わったら待たせていた他の処理リクエストにも戻り値を配ってくれるやつ。キャッシュ切れ時の origin リクエストに使ったりすると良さそう</li>\n</ul>\n<p>どれも chan を使って自作できそうな（今までは自作していた）ようなものではありますが、特にトラブル時の問題切り分けを煩雑にしないためにも積極的に利用していきたいところです。</p>\n<p>特にマイクロサービス構成の動画サービスでは各所で重いデータのリクエストや更新管理の難しいキャッシュデータが生まれがちなので、 <code class=\"language-text\">singleflight</code> は今後ぜひ使っていきたいなーと思っております。</p>\n<p>スライドには使用イメージとしてサンプルコードも載せてありますので、ぜひ見ていただけると嬉しいです。</p>\n<h2>スライド制作</h2>\n<p>以前から使っている <a href=\"https://twitter.com/ahomu\">@ahomu</a> さん製の <a href=\"https://github.com/ahomu/Talkie\">Talkie</a> をラップした、 <a href=\"https://github.com/hori-ryota/talkiego\">talkiego</a> で作りました。今回のスライドを作るにあたって <a href=\"https://highlightjs.org/\">highlight.js</a> の Go 対応と、 <code class=\"language-text\">serve</code> コマンドのオプション指定機能を追加しました。</p>\n<blockquote>\n<p><a href=\"https://github.com/hori-ryota/talkiego\">hori-ryota/talkiego: talkiego is wrapper for Talkie.</a></p>\n</blockquote>\n<p>カスタムテーマは未対応ですが、カスタム CSS は対応してみたのでとりあえず色々とカスタムはできるはず。とはいえ自分はデフォルトでしか使っていないです。</p>\n<h2>お礼</h2>\n<p>前回に引き続き、今回も主催兼、司会兼、第一登壇者で参加させていただきました。登壇タイトルの更新が遅かったり、登壇者の入れ替えがあったり、ご迷惑をおかけいたしました。</p>\n<p>ポツポツと雨が降っているにも関わらず多くの方々に足を運んでいただき嬉しく思っております。ぜひ今後も有益な情報を提供できるよう尽力してますので、今後とも宜しくお願いいたします。</p>\n<p>次回からは登壇からは身を引いて、運用に回ろうかなーと思っております（といいつつまた出てくるかもです）。</p>\n<p>また2,3ヶ月後に第三回を実施したいなーと思っています。よろしくお願いいたします！</p>","excerpt":"CA.go #2 - connpass にて golang.org/x/sync 以下にある4つのパッケージを用いて効率的に非同期処理をする技術についてお話しました。","frontmatter":{"date":"2017-09-06T23:30:00+09:00","title":"CA.go #2 で golang.org/x/sync について喋りました #ca_go","tags":["Output","Conference","Development","Go"],"eyecatch":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAADLUlEQVQ4y2WSWVMbVxCFZx9pRsugBe3rSIiBEZJACi4WI7MZkMHIECBxEpSqxE/5/69fWguOq/LQNT33nnv69OlWmk6KejRDwy3SzPjUCx1y2RbJTBMn08DNtYmVA+KNLrFqQKy+TaK9g1OQu/IGbnFTIsDJtol6NZTQyxN6ZUJ5vF3wCeRx0BpQa/WFqEPC3yHZ7pHs9Ilv9Ehs9oh1utheBjuRIhkMiDelWDkUAS2U/nqBfr4iClNspMr463UqOZ903idSbGEVmlj1Tcx6G1twVrZIabtLNuyimA5GqYld6RCvhbiFLZRBvcyo2WB2/8Bs+sLs8TfOTq6Y3D1zcvfI9viC81//4PB6wsHBIfuHpzx//Z2XP2ccXXxkfDtl9+Yep7pFNFkUwtCn36zwz+yV54+fuBy952B4zPH4munrXwSnF3TOLhhff+Lm4YH+uyMGEkc3E4YfTvGDkK3xlfjYQtc0lL1OlX6txHY+z1a2xHiwTyzqUqk08MM9qX7L6Pae0eEJX15nTJ6eGZ9f8dP5JY3RAYpiEim1cdNlNFVFKSfj+Ok0e+UqXfFot7tDJpslDEOKpTKD/fcM353R6+0xurxhNPnM7nCf3s4uQSA+KppMuEFEZqAqCsqGlyZIrdPPVSQa2AIwDINypUqxUCSUifp+QLXSpNYfUukN2ZQ2VUXUCMGcxHIzRBNFVFUI+2sFtrwcG7I+rUQeQ2Qnkgmmd5/5cHDM05cnnn7+hen9Iw8vX5lMH/n29zeiUUcI1UWbpuVi2IklYTFdpRPP4RomlqaiC0DTddbEx7gZISKr4dgxom6OqCO7F3GxLBtN01FlCOocL19NXeaKW+rgJbNoIl1bXOrLC/nXrSi6kOpCYsRSGPHM4nwRK4I37KL9eR7xCkScpJC9AVcVRaUjPrrFCnaugL2eJSL7qnvJ/4hWMRdhzFdm/j/fHcewlqC3FubVhTCSFrOTaxhra5ixOIbnSe6tcMp3dZpurjpT3gjN5Q6t1OmaiWnYmAI2xXh1NU1NzucW/GjL/1qeExgrgPoDoS3DsKSQa1rourE4N8RTW3xcEK4Ilh2p3/N/AUGNg/1lmSpyAAAAAElFTkSuQmCC","aspectRatio":1.3333333333333333,"src":"/static/5338e38b05c0cdb9ebc3cd27ea80e796/5707d/eyecatch.png","srcSet":"/static/5338e38b05c0cdb9ebc3cd27ea80e796/497c6/eyecatch.png 400w,\n/static/5338e38b05c0cdb9ebc3cd27ea80e796/ee604/eyecatch.png 800w,\n/static/5338e38b05c0cdb9ebc3cd27ea80e796/5707d/eyecatch.png 1600w,\n/static/5338e38b05c0cdb9ebc3cd27ea80e796/0ef64/eyecatch.png 2400w,\n/static/5338e38b05c0cdb9ebc3cd27ea80e796/2685c/eyecatch.png 2560w","srcWebp":"/static/5338e38b05c0cdb9ebc3cd27ea80e796/7c22d/eyecatch.webp","srcSetWebp":"/static/5338e38b05c0cdb9ebc3cd27ea80e796/1f5c5/eyecatch.webp 400w,\n/static/5338e38b05c0cdb9ebc3cd27ea80e796/58556/eyecatch.webp 800w,\n/static/5338e38b05c0cdb9ebc3cd27ea80e796/7c22d/eyecatch.webp 1600w,\n/static/5338e38b05c0cdb9ebc3cd27ea80e796/f1e40/eyecatch.webp 2400w,\n/static/5338e38b05c0cdb9ebc3cd27ea80e796/ab8d3/eyecatch.webp 2560w","sizes":"(max-width: 1600px) 100vw, 1600px"},"original":{"src":"/static/eyecatch-5338e38b05c0cdb9ebc3cd27ea80e796.png","width":2560,"height":1920}}}}}},"pageContext":{"urlPath":"/blog/cago-2-x-sync/","previous":{"fields":{"urlPath":"/blog/study-hls-keyframe-20170808/","jstDate":"2017-08-08"},"frontmatter":{"title":"社内勉強会で HLS と Key frame について改めて解説した","date":"2017-08-08"}},"next":{"fields":{"urlPath":"/blog/failed-to-grpc-with-nlb/","jstDate":"2017-10-22"},"frontmatter":{"title":"gRPC with NLB は idle timeout に気をつけないと死ぬ","date":"2017-10-22"}}}},"staticQueryHashes":["1862978031","277821901","4270455655"]}