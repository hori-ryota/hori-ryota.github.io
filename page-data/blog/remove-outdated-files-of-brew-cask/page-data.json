{"componentChunkName":"component---src-templates-blog-jsx","path":"/blog/remove-outdated-files-of-brew-cask/","result":{"data":{"markdownRemark":{"fields":{"urlPath":"/blog/remove-outdated-files-of-brew-cask/","jstDate":"2015-07-11"},"html":"<p>Homebrew caskで古いバージョンのファイルを削除するワンライナーを作りました。</p>\n<p><strong>公式では非推奨として実装されていない機能なので、利用に関しては自己責任でお願いします。</strong></p>\n<!--more-->\n<h2>とりあえずコード</h2>\n<p>これ。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">c</span> <span class=\"token keyword\">in</span> /opt/homebrew-cask/Caskroom/*<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token assign-left variable\">vl</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">ls</span> -t $c<span class=\"token variable\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">v</span> <span class=\"token keyword\">in</span> <span class=\"token string\">\"<span class=\"token variable\">${vl<span class=\"token punctuation\">[</span>@<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span>1}</span>\"</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token function\">rm</span> -rf <span class=\"token string\">\"<span class=\"token variable\">$c</span>/<span class=\"token variable\">$v</span>\"</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span></code></pre></div>\n<p>aliasとか設定しておくと便利そう。こんな感じ。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">alias</span> brew-cask-clean-outdated<span class=\"token operator\">=</span><span class=\"token string\">'for c in /opt/homebrew-cask/Caskroom/*; do vl=(<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">ls</span> -t $c<span class=\"token variable\">`</span></span>) &amp;&amp; for v in \"<span class=\"token variable\">${vl<span class=\"token punctuation\">[</span>@<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span>1}</span>\"; do rm -rf \"<span class=\"token variable\">$c</span>/<span class=\"token variable\">$v</span>\"; done; done'</span></code></pre></div>\n<h2>説明</h2>\n<p>Homebrew caskは<code class=\"language-text\">brew cask install application-name</code>みたいなコマンドでアプリがインストールできる便利なツールです。</p>\n<blockquote>\n<p><a href=\"http://caskroom.io/\">Homebrew Cask</a></p>\n</blockquote>\n<p>とまぁ便利なのですが、installしてあるアプリのアップデート周りが諸々の事情で難しく…。</p>\n<p>自分は以下のワンライナーをalias登録して、updateコマンドとして使っています。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">alias</span> brew-cask-update<span class=\"token operator\">=</span><span class=\"token string\">'for c in <span class=\"token variable\"><span class=\"token variable\">`</span>brew cask list<span class=\"token variable\">`</span></span>; do ! brew cask info <span class=\"token variable\">$c</span> | grep -qF \"Not installed\" || brew cask install <span class=\"token variable\">$c</span>; done'</span></code></pre></div>\n<blockquote>\n<p>参考：<a href=\"https://github.com/caskroom/homebrew-cask/issues/309#issuecomment-36743989\">brew cask upgrade · Issue #309 · caskroom/homebrew-cask</a></p>\n</blockquote>\n<p>このスクリプトで新しいバージョンがCaskに登録されていればインストールされるのですが、古いバージョンの削除まではやってくれません。（不具合生じる可能性があるから組み込んでないとかなんとか）</p>\n<p>困るのがAlfredなどを使用している場合で、<code class=\"language-text\">/opt/homebrew-cask/Caskroom/</code>下にあるアプリを見に行くので古いバージョンも拾ってしまうのです。</p>\n<p>ので、あくまで自己責任の範囲で作成したのが冒頭のスクリプト。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">c</span> <span class=\"token keyword\">in</span> /opt/homebrew-cask/Caskroom/*<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token assign-left variable\">vl</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">ls</span> -t $c<span class=\"token variable\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">v</span> <span class=\"token keyword\">in</span> <span class=\"token string\">\"<span class=\"token variable\">${vl<span class=\"token punctuation\">[</span>@<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span>1}</span>\"</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token function\">rm</span> -rf <span class=\"token string\">\"<span class=\"token variable\">$c</span>/<span class=\"token variable\">$v</span>\"</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span></code></pre></div>\n<p>Caskroomディレクトリ下のアプリ全てに対し、バージョンごとのディレクトリを日時情報で降順ソート→2つ目から削除って感じです。</p>\n<p>updateコマンド時に削除しようとするとこんな感じ？</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">alias</span> brew-cask-update<span class=\"token operator\">=</span><span class=\"token string\">'for c in <span class=\"token variable\"><span class=\"token variable\">`</span>brew cask list<span class=\"token variable\">`</span></span>; do ! brew cask info <span class=\"token variable\">$c</span> | grep -qF \"Not installed\" || brew cask install <span class=\"token variable\">$c</span>; done &amp;&amp; brew-cask-clean-outdated'</span></code></pre></div>\n<p>アップデート時に削除するだけでいいならこれでいいかも。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">alias</span> brew-cask-update<span class=\"token operator\">=</span><span class=\"token string\">'for c in <span class=\"token variable\"><span class=\"token variable\">`</span>brew cask list<span class=\"token variable\">`</span></span>; do ! brew cask info <span class=\"token variable\">$c</span> | grep -qF \"Not installed\" || brew cask uninstall <span class=\"token variable\">$c</span> --force &amp;&amp; brew cask install <span class=\"token variable\">$c</span>; done'</span></code></pre></div>\n<p>新しいバージョンに切り替える前にアンインストールしちゃうのが気持ち悪いので、私はとりあえず前者の方を使ってみてます。</p>\n<p>もしこうしたほうがいいよ！とかあれば教えて下さい〜</p>","excerpt":"Homebrew caskで古いバージョンのファイルを削除するワンライナーを作りました。 公式では非推奨として実装されていない機能なので、利用に関しては自己責任でお願いします。","frontmatter":{"date":"2015-07-11T19:00:00+09:00","title":"Homebrew caskの古いバージョンを削除するワンライナー","tags":["Development","Shell","Homebrew"],"eyecatch":null}}},"pageContext":{"urlPath":"/blog/remove-outdated-files-of-brew-cask/","previous":{"fields":{"urlPath":"/blog/listen-to-music-on-awa-with-mac/","jstDate":"2015-06-05"},"frontmatter":{"title":"AWAの音楽をPC（Mac）で聴く方法","date":"2015-06-04"}},"next":{"fields":{"urlPath":"/blog/ffmpeg-mp4-concatenate/","jstDate":"2016-06-16"},"frontmatter":{"title":"FFmpegでMP4を結合（concat）するワンライナー","date":"2016-06-16"}}}},"staticQueryHashes":["1862978031","277821901","4270455655"]}